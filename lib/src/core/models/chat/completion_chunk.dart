/// Represents a tool call within a completion chunk.
/// Aligns with OpenAI's `ToolCall` in streaming chunks.
class LlamaCompletionChunkToolCall {
  /// The index of the tool call in the list of tool calls.
  final int index;

  /// The ID of the tool call. Only present in the first chunk for this tool call.
  final String? id;

  /// The type of the tool call. Usually "function".
  final String? type;

  /// The arguments delta. This is a JSON fragment that should be accumulated.
  final LlamaCompletionChunkFunction? function;

  /// Creates a new [LlamaCompletionChunkToolCall].
  LlamaCompletionChunkToolCall({
    required this.index,
    this.id,
    this.type,
    this.function,
  });

  /// Creates a [LlamaCompletionChunkToolCall] from a JSON map.
  factory LlamaCompletionChunkToolCall.fromJson(Map<String, dynamic> json) {
    return LlamaCompletionChunkToolCall(
      index: json['index'] as int,
      id: json['id'] as String?,
      type: json['type'] as String?,
      function: json['function'] != null
          ? LlamaCompletionChunkFunction.fromJson(
              json['function'] as Map<String, dynamic>,
            )
          : null,
    );
  }

  /// Converts this object to a JSON map.
  Map<String, dynamic> toJson() {
    return {
      'index': index,
      if (id != null) 'id': id,
      if (type != null) 'type': type,
      if (function != null) 'function': function!.toJson(),
    };
  }

  @override
  String toString() =>
      'LlamaCompletionChunkToolCall(index: $index, id: $id, type: $type, function: $function)';
}

/// Represents a function call within a tool call.
class LlamaCompletionChunkFunction {
  /// The name of the function.
  final String? name;

  /// The arguments of the function (JSON fragment).
  final String? arguments;

  /// Creates a new [LlamaCompletionChunkFunction].
  LlamaCompletionChunkFunction({this.name, this.arguments});

  /// Creates a [LlamaCompletionChunkFunction] from a JSON map.
  factory LlamaCompletionChunkFunction.fromJson(Map<String, dynamic> json) {
    return LlamaCompletionChunkFunction(
      name: json['name'] as String?,
      arguments: json['arguments'] as String?,
    );
  }

  /// Converts this object to a JSON map.
  Map<String, dynamic> toJson() {
    return {
      if (name != null) 'name': name,
      if (arguments != null) 'arguments': arguments,
    };
  }

  @override
  String toString() =>
      'LlamaCompletionChunkFunction(name: $name, arguments: $arguments)';
}

/// Represents a streaming chunk of a chat completion.
/// Aligns with OpenAI's `ChatCompletionChunk`.
class LlamaCompletionChunk {
  /// A unique identifier for the completion.
  final String id;

  /// The object type, which is always "chat.completion.chunk".
  final String object;

  /// The Unix timestamp (in seconds) of when the completion was created.
  final int created;

  /// The model used for completion.
  final String model;

  /// A list of completion choices.
  final List<LlamaCompletionChunkChoice> choices;

  /// Creates a new [LlamaCompletionChunk].
  LlamaCompletionChunk({
    required this.id,
    required this.object,
    required this.created,
    required this.model,
    required this.choices,
  });

  /// Creates a [LlamaCompletionChunk] from a JSON map.
  factory LlamaCompletionChunk.fromJson(Map<String, dynamic> json) {
    return LlamaCompletionChunk(
      id: json['id'] as String,
      object: json['object'] as String,
      created: json['created'] as int,
      model: json['model'] as String,
      choices: (json['choices'] as List<dynamic>)
          .map(
            (e) =>
                LlamaCompletionChunkChoice.fromJson(e as Map<String, dynamic>),
          )
          .toList(),
    );
  }

  /// Converts this object to a JSON map.
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'object': object,
      'created': created,
      'model': model,
      'choices': choices.map((e) => e.toJson()).toList(),
    };
  }

  @override
  String toString() =>
      'LlamaCompletionChunk(id: $id, object: $object, created: $created, model: $model, choices: $choices)';
}

/// Represents a choice in a completion chunk.
class LlamaCompletionChunkChoice {
  /// The index of the choice in the list of choices.
  final int index;

  /// A chat completion delta generated by streamed model responses.
  final LlamaCompletionChunkDelta delta;

  /// The reason the model stopped generating tokens.
  final String? finishReason;

  /// Creates a new [LlamaCompletionChunkChoice].
  LlamaCompletionChunkChoice({
    required this.index,
    required this.delta,
    this.finishReason,
  });

  /// Creates a [LlamaCompletionChunkChoice] from a JSON map.
  factory LlamaCompletionChunkChoice.fromJson(Map<String, dynamic> json) {
    return LlamaCompletionChunkChoice(
      index: json['index'] as int,
      delta: LlamaCompletionChunkDelta.fromJson(
        json['delta'] as Map<String, dynamic>,
      ),
      finishReason: json['finish_reason'] as String?,
    );
  }

  /// Converts this object to a JSON map.
  Map<String, dynamic> toJson() {
    return {
      'index': index,
      'delta': delta.toJson(),
      if (finishReason != null) 'finish_reason': finishReason,
    };
  }

  @override
  String toString() =>
      'LlamaCompletionChunkChoice(index: $index, delta: $delta, finishReason: $finishReason)';
}

/// Represents a delta in a completion choice.
class LlamaCompletionChunkDelta {
  /// The contents of the chunk message.
  final String? content;

  /// The tool calls information.
  final List<LlamaCompletionChunkToolCall>? toolCalls;

  /// The thinking content (LlamaDart extension).
  final String? thinking;

  /// The role of the author of this message.
  final String? role;

  /// Creates a new [LlamaCompletionChunkDelta].
  LlamaCompletionChunkDelta({
    this.content,
    this.toolCalls,
    this.thinking,
    this.role,
  });

  /// Creates a [LlamaCompletionChunkDelta] from a JSON map.
  factory LlamaCompletionChunkDelta.fromJson(Map<String, dynamic> json) {
    return LlamaCompletionChunkDelta(
      content: json['content'] as String?,
      toolCalls: (json['tool_calls'] as List<dynamic>?)
          ?.map(
            (e) => LlamaCompletionChunkToolCall.fromJson(
              e as Map<String, dynamic>,
            ),
          )
          .toList(),
      thinking: json['thinking'] as String?,
      role: json['role'] as String?,
    );
  }

  /// Converts this object to a JSON map.
  Map<String, dynamic> toJson() {
    return {
      if (content != null) 'content': content,
      if (toolCalls != null)
        'tool_calls': toolCalls!.map((e) => e.toJson()).toList(),
      if (thinking != null) 'thinking': thinking,
      if (role != null) 'role': role,
    };
  }

  @override
  String toString() =>
      'LlamaCompletionChunkDelta(content: $content, toolCalls: $toolCalls, thinking: $thinking, role: $role)';
}
